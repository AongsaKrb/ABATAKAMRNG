script.Parent.Changed:Connect(function()
	local targetValue = script.Parent.Value

	if targetValue == true then
		local running = true

		task.spawn(function()
			while running do
				task.spawn(function()
					local Players = game:GetService("Players")
					local ply = Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")

					for _, v in pairs(workspace.NaturalIemSpawn.Objects:GetChildren()) do
						if v:FindFirstChild("ProximityPrompt") then
							v.Anchored = true
							task.wait(1)
							v.Anchored = false
							v.CFrame = CFrame.new(ply.Position + Vector3.new(0, 2, 0))
							task.wait(1)

							if v.CanCollide then
								for _, pp in pairs(workspace.NaturalIemSpawn.Objects:GetDescendants()) do
									local prompt = pp:FindFirstChild("ProximityPrompt")
									if prompt and prompt.Enabled then
										for i = 1, 10 do
											pcall(function()
												fireproximityprompt(prompt)
											end)
											task.wait(0.1)
										end

										if prompt:IsDescendantOf(workspace) and prompt.Enabled then
											pp.CFrame = pp.CFrame + Vector3.new(0, 10, 0)
										end
									end
								end
								task.wait(5)
							end
							task.wait(5)
							v:Destroy()
							break
						end
					end
				end)

				task.wait(0.5) -- เว้นช่วงก่อน spawn รอบถัดไป
			end
		end)

		script.Parent.Changed:Wait()
		if script.Parent.Value == false then
			running = false
		end
	end
end)
